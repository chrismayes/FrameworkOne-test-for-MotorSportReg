-- DB Schema for MotorSportReg



-- "TRACK" Table:

CREATE TABLE [dbo].[track](
	[track_id] [int] NOT NULL,
	[track_name] [varbinary](50) NOT NULL,
	[track_abbreviation] [varbinary](10) NOT NULL,
 CONSTRAINT [PK_track] PRIMARY KEY CLUSTERED 
(
	[id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]


INSERT INTO track (track_id, track_name, track_abbreviation)
VALUES (1, 'Mazda Raceway Laguna Seca', 'MRLS')

INSERT INTO track (track_id, track_name, track_abbreviation)
VALUES (2, 'Road America', 'CenDiv')



-- "LAP" Table

CREATE TABLE [dbo].[lap](
	[lap_id] [int] NOT NULL,
	[track_id] [int] NOT NULL,
	[class] [char](4) NOT NULL,
	[comment] [varchar](max) NOT NULL,
	[lap_time] [int] NOT NULL,
	[lap_date] [datetime] NOT NULL,
 CONSTRAINT [PK_lap] PRIMARY KEY CLUSTERED 
(
	[lap_id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

ALTER TABLE [dbo].[lap]  WITH CHECK ADD  CONSTRAINT [FK_lap_track] FOREIGN KEY([track_id])
REFERENCES [dbo].[track] ([track_id])

ALTER TABLE [dbo].[lap] CHECK CONSTRAINT [FK_lap_track]



-- "HISTORY" Table

CREATE TABLE [dbo].[history](
	[history_id] [int] NOT NULL,
	[track_id] [int] NOT NULL,
	[import_file_name] [varchar](255) NOT NULL,
	[date_added] [datetime] NOT NULL,
 CONSTRAINT [PK_history] PRIMARY KEY CLUSTERED 
(
	[history_id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

ALTER TABLE [dbo].[history]  WITH CHECK ADD  CONSTRAINT [FK_history_track] FOREIGN KEY([track_id])
REFERENCES [dbo].[track] ([track_id])

ALTER TABLE [dbo].[history] CHECK CONSTRAINT [FK_history_track]



-- "LAP_HISTORY" Table

CREATE TABLE [dbo].[lap_history](
	[lap_id] [int] NOT NULL,
	[history_id] [int] NOT NULL
) ON [PRIMARY]


ALTER TABLE [dbo].[lap_history]  WITH CHECK ADD  CONSTRAINT [FK_lap_history_history] FOREIGN KEY([history_id])
REFERENCES [dbo].[history] ([history_id])

ALTER TABLE [dbo].[lap_history] CHECK CONSTRAINT [FK_lap_history_history]

ALTER TABLE [dbo].[lap_history]  WITH CHECK ADD  CONSTRAINT [FK_lap_history_lap] FOREIGN KEY([lap_id])
REFERENCES [dbo].[lap] ([lap_id])

ALTER TABLE [dbo].[lap_history] CHECK CONSTRAINT [FK_lap_history_lap]

